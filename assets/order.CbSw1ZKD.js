import{b as r,r as t,s as e}from"./request.Bx5oBM20.js";const s={async getOrderStats(r){if(!r)return{0:0,1:0,2:0,3:0,4:0};const s=await t(async()=>{const{data:t,error:s}=await e.from("orders").select("status").eq("user_id",r);if(s)throw s;return t},{requestId:`order_stats_${r}`,showLoading:!1}),a=s&&s.data?s.data:[],o={0:0,1:0,2:0,3:0,4:0};return a.forEach(r=>{void 0!==o[r.status]&&o[r.status]++}),o},async getUserOrders(r){if(!r)return[];const s=await t(async()=>e.from("orders").select("\n                    *,\n                    order_items (\n                        *,\n                        goods ( title:name, image:images )\n                    )\n                ").eq("user_id",r).order("created_at",{ascending:!1}),{requestId:`orders_all_user_${r}`,showLoading:!0});return s&&s.data?s.data:[]},async createOrder(r){const s=await t(async()=>{const t=Date.now().toString()+Math.floor(1e4*Math.random()).toString().padStart(4,"0"),{data:s,error:a}=await e.from("orders").insert({order_no:t,user_id:r.userId,total_amount:r.totalAmount,status:0,remark:r.remark||""}).select().single();if(a)throw a;const o=r.goodsList.map(r=>({order_id:s.id,goods_id:r.goods_id||r.id,goods_name:r.title||r.name,goods_image:r.image,price:r.price,quantity:r.qty})),{error:d}=await e.from("order_items").insert(o);if(d)throw d;return{success:!0,orderId:s.id}},{showLoading:!0,loadingText:"正在创建订单"});return s?s.data:{error:"创建订单失败，请稍后再试"}},async payOrder(t){const e=await r("orders",t,{status:1},{showLoading:!0,loadingText:"支付中..."});return e.success?{success:!0}:{error:e.error||"支付失败"}},async cancelOrder(t){const e=await r("orders",t,{status:4},{showLoading:!0,loadingText:"取消中..."});return e.success?{success:!0}:{error:e.error||"取消失败"}}};export{s as o};
