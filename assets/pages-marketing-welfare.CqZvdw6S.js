import{_ as e,k as s,t as a,c as t,w as l,v as c,x as o,M as i,y as u,o as n,a as d,C as r,B as f,K as _,L as m,H as p,D as v,F as g,E as h,Z as y,$ as k,N as b,W as w}from"./vendor.Ckgv2xgH.js";import{m as C}from"./marketing.B3uJcO8V.js";import{u as R}from"./request.Bx5oBM20.js";const x=e({__name:"welfare",setup(e){const x=R(),I=s(!1),L=s([]),j=s(!1),D=()=>{I.value||(y({title:"签到中..."}),setTimeout(()=>{I.value=!0,k(),b({title:"签到成功 +5积分",icon:"success"})},800))};return a(()=>{(async()=>{var e;j.value=!0;try{const s=await C.getAvailableCoupons();let a=[];x.isLogin&&(null==(e=x.userInfo)?void 0:e.id)&&(a=await C.getMyCoupons(x.userInfo.id));const t=new Set(a.map(e=>e.coupon_id));L.value=s.map(e=>({...e,isReceived:t.has(e.id),date:e.end_time?`有效期至 ${new Date(e.end_time).toLocaleDateString()}`:"长期有效"}))}catch(s){console.error("加载优惠券失败",s)}finally{j.value=!1}})()}),(e,s)=>{const a=c,R=f,j=o(u("uni-icons"),i);return n(),t(a,{class:"container"},{default:l(()=>[d(a,{class:"header-bg"},{default:l(()=>[d(a,{class:"header-content"},{default:l(()=>[d(a,{class:"title"},{default:l(()=>[r("每日福利")]),_:1}),d(a,{class:"subtitle"},{default:l(()=>[r("连续签到领好礼")]),_:1})]),_:1})]),_:1}),d(a,{class:"check-in-card"},{default:l(()=>[d(a,{class:"left"},{default:l(()=>[d(R,{class:"days"},{default:l(()=>[r("已连续签到 "),d(R,{class:"highlight"},{default:l(()=>[r("3")]),_:1}),r(" 天")]),_:1}),d(R,{class:"tip"},{default:l(()=>[r("明日签到可得 "),d(R,{class:"coin"},{default:l(()=>[r("10")]),_:1}),r(" 积分")]),_:1})]),_:1}),d(a,{class:_(["check-btn",{signed:I.value}]),onClick:D},{default:l(()=>[I.value?(n(),t(j,{key:0,type:"checkmarkempty",size:"16",color:"#999"})):m("",!0),d(R,null,{default:l(()=>[r(p(I.value?"已签到":"立即签到"),1)]),_:1})]),_:1},8,["class"])]),_:1}),d(a,{class:"coupon-section"},{default:l(()=>[d(a,{class:"sec-header"},{default:l(()=>[d(R,{class:"sec-title"},{default:l(()=>[r("领券中心")]),_:1}),d(R,{class:"sec-desc"},{default:l(()=>[r("先领券 再购物")]),_:1})]),_:1}),d(a,{class:"coupon-list"},{default:l(()=>[(n(!0),v(g,null,h(L.value,(e,s)=>(n(),t(a,{class:"coupon-item",key:s},{default:l(()=>[d(a,{class:"left-part"},{default:l(()=>[d(a,{class:"price-box"},{default:l(()=>[d(R,{class:"symbol"},{default:l(()=>[r("¥")]),_:1}),d(R,{class:"money"},{default:l(()=>[r(p(e.money),1)]),_:2},1024)]),_:2},1024),d(R,{class:"cond"},{default:l(()=>[r(p(e.condition),1)]),_:2},1024)]),_:2},1024),d(a,{class:"dashed-line"}),d(a,{class:"right-part"},{default:l(()=>[d(a,{class:"info"},{default:l(()=>[d(a,{class:"tags"},{default:l(()=>[d(R,{class:"tag"},{default:l(()=>[r(p("platform"===e.type?"平台券":"专项券"),1)]),_:2},1024),d(R,{class:"name"},{default:l(()=>[r(p(e.name),1)]),_:2},1024)]),_:2},1024),d(R,{class:"date"},{default:l(()=>[r(p(e.date),1)]),_:2},1024)]),_:2},1024),d(a,{class:_(["get-btn",{received:e.isReceived||e.stock<=0}]),"hover-class":"btn-hover",onClick:s=>(async e=>{if(e.isReceived||e.stock<=0)return;if(!x.isLogin)return b({title:"请先登录",icon:"none"}),void setTimeout(()=>{w({url:"/pages/user/user"})},1e3);y({title:"领取中..."});const s=await C.receiveCoupon(e.id,x.userInfo.id);k(),s.success?(b({title:"领取成功",icon:"success"}),e.isReceived=!0):b({title:s.error||"领取失败",icon:"none"})})(e)},{default:l(()=>[r(p(e.isReceived?"已领取":e.stock<=0?"已抢光":"立即领取"),1)]),_:2},1032,["class","onClick"])]),_:2},1024),d(a,{class:"circle-top"}),d(a,{class:"circle-bottom"})]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}},[["__scopeId","data-v-5912665e"]]);export{x as default};
