import{_ as a,k as s,l as t,U as e,t as l,c as o,w as r,Z as u,$ as n,v as c,x as d,M as i,y as f,o as _,a as m,D as v,F as p,E as y,K as g,C as k,H as b,B as C,G as x,L as j,a0 as q,Q as w,N as I}from"./vendor.Ckgv2xgH.js";import{o as h}from"./order.CbSw1ZKD.js";import{u as $}from"./request.Bx5oBM20.js";import{u as A}from"./useSystem.Wa4UmrYm.js";const F=a({__name:"order",setup(a){const F=$(),{navTo:O}=A(),U=s(0),z=["全部","待付款","待发货","待收货","待评价"],B=s([]),D=t(()=>{if(0===U.value)return B.value;const a=U.value-1;return B.value.filter(s=>s.status===a)}),E=async()=>{var a;if(!(null==(a=F.userInfo)?void 0:a.id))return void(B.value=[]);u({title:"加载中"});const s=await h.getUserOrders(F.userInfo.id);B.value=s||[],n()},G=a=>{var s;if(a.goods_image)return a.goods_image;const t=null==(s=a.goods)?void 0:s.image;return Array.isArray(t)&&t.length>0?t[0]:t||"/static/product1.png"},H=a=>{var s;return(null==(s=a.order_items)?void 0:s.reduce((a,s)=>a+s.quantity,0))||0};return e(a=>{a.state&&(U.value=parseInt(a.state)+1)}),l(()=>{E()}),(a,s)=>{const t=c,e=C,l=x,$=q,A=d(f("uni-icons"),i);return _(),o(t,{class:"container"},{default:r(()=>[m(t,{class:"tabs"},{default:r(()=>[(_(),v(p,null,y(z,(a,s)=>m(t,{class:g(["tab-item",{active:U.value===s}]),key:s,onClick:a=>(a=>{U.value=a})(s)},{default:r(()=>[k(b(a),1)]),_:2},1032,["class","onClick"])),64))]),_:1}),m(t,{class:"content"},{default:r(()=>[D.value.length>0?(_(),o(t,{key:0,class:"order-list"},{default:r(()=>[(_(!0),v(p,null,y(D.value,a=>(_(),o(t,{class:"order-item",key:a.id},{default:r(()=>[m(t,{class:"order-header"},{default:r(()=>[m(e,{class:"order-no"},{default:r(()=>[k("订单号："+b(a.order_no),1)]),_:2},1024),m(e,{class:"order-status"},{default:r(()=>{return[k(b((s=a.status,{0:"待付款",1:"待发货",2:"待收货",3:"待评价",4:"已完成"}[s]||"未知状态")),1)];var s}),_:2},1024)]),_:2},1024),m(t,{class:"goods-list"},{default:r(()=>[(_(!0),v(p,null,y(a.order_items,a=>(_(),o(t,{class:"goods-item",key:a.id},{default:r(()=>[m(l,{src:G(a),mode:"aspectFill",class:"goods-img"},null,8,["src"]),m(t,{class:"goods-info"},{default:r(()=>[m(e,{class:"goods-title"},{default:r(()=>{var s;return[k(b(a.goods_name||(null==(s=a.goods)?void 0:s.name)),1)]}),_:2},1024),m(t,{class:"price-box"},{default:r(()=>[m(e,{class:"price"},{default:r(()=>[k("¥"+b(a.price),1)]),_:2},1024),m(e,{class:"num"},{default:r(()=>[k("x"+b(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),m(t,{class:"order-footer"},{default:r(()=>[m(t,{class:"total-info"},{default:r(()=>[m(e,null,{default:r(()=>[k("共 "+b(H(a))+" 件商品 实付 ",1)]),_:2},1024),m(e,{class:"total-price"},{default:r(()=>[k("¥"+b(a.payment_amount||a.total_amount),1)]),_:2},1024)]),_:2},1024),m(t,{class:"action-box"},{default:r(()=>[0===a.status?(_(),o($,{key:0,class:"action-btn",onClick:s=>(a=>{O(`/pages/money/pay?amount=${a.payment_amount||a.total_amount}&id=${a.id}`)})(a)},{default:r(()=>[k("去支付")]),_:2},1032,["onClick"])):j("",!0),0===a.status?(_(),o($,{key:1,class:"action-btn plain",onClick:s=>(a=>{w({title:"提示",content:"确定要取消该订单吗？",success:async s=>{if(s.confirm){u({title:"处理中"});const s=await h.cancelOrder(a.id);n(),s.success?(I({title:"订单已取消"}),E()):I({title:"取消失败",icon:"none"})}}})})(a)},{default:r(()=>[k("取消订单")]),_:2},1032,["onClick"])):j("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(_(),o(t,{key:1,class:"empty-state"},{default:r(()=>[m(A,{type:"cart",size:"50",color:"#ccc"}),m(e,{class:"empty-text"},{default:r(()=>[k("暂时没有相关订单")]),_:1})]),_:1}))]),_:1})]),_:1})}}},[["__scopeId","data-v-4130cbd3"]]);export{F as default};
